var dtx=function(e){"use strict";class t{constructor(e,t){this.callback=e,this.id=t}}class s{add(e,s){this.callbacks||(this.callbacks=new Array),this.callbacks.push(new t(e,s))}remove(e){if(this.callbacks)for(let t=this.callbacks.length-1;t>=0;--t)this.callbacks[t].id===e&&this.callbacks.splice(t,1)}count(){return this.callbacks?this.callbacks.length:0}lock(){this.locked=!0}unlock(){if(this.locked=void 0,this.triggered){let e=this.triggered.data;this.triggered=void 0,this.trigger(e)}}trigger(e){if(this.locked)this.triggered={data:e};else if(this.callbacks)for(let t=0;t<this.callbacks.length;++t)this.callbacks[t].callback(e)}}class a{constructor(){this.modified=new s}}class i extends a{constructor(e){super(),this._value=e}set promise(e){this._value=e,this.modified.trigger()}get promise(){return"string"==typeof this._value?()=>this._value:this._value}set value(e){this._value!==e&&("string"==typeof e?(this._value=e,this.modified.trigger()):console.trace(`TextModel.set value(value: string): ${typeof e} is not type string`))}get value(){switch(typeof this._value){case"number":case"string":this._value=`${this._value}`;break;case"function":this._value=this._value()}return this._value}}class r extends a{constructor(e){super(),this._value=e}set value(e){this._value!=e&&(this._value=e,this.modified.trigger())}get value(){return this._value}}class o extends r{constructor(e,t){super(e),t&&(this.min=t.min,this.max=t.max,this.step=t.step)}}class n extends r{constructor(e){super(e)}}class l extends i{constructor(e){super(e)}}class d extends a{constructor(e,t){super(),this.signal=new s,this.title=t,this._enabled=!0}set value(e){throw Error("Action.value can not be assigned a value")}get value(){throw Error("Action.value can not return a value")}set enabled(e){this._enabled!=e&&(this._enabled=e,this.modified.trigger())}get enabled(){return this._enabled}trigger(e){this._enabled&&this.signal.trigger(e)}}let c=new class{constructor(){this.modelId2Models=new Map,this.modelId2Views=new Map,this.view2ModelIds=new Map,this.sigChanged=new s}registerAction(e,t){let s=new d(void 0,e);return s.signal.add(t),this._registerModel("A:"+e,s),s}registerModel(e,t){this._registerModel("M:"+e,t)}_registerModel(e,t){let s=this.modelId2Models.get(e);s||(s=new Set,this.modelId2Models.set(e,s)),s.add(t);let a=this.modelId2Views.get(e);if(a)for(let e of a)e.setModel(t)}registerView(e,t){if(t.controller&&t.controller!==this)return void console.log("error: attempt to register view more than once at different controllers");t.controller=this;let s=this.view2ModelIds.get(t);s||(s=new Set,this.view2ModelIds.set(t,s)),s.add(e);let a=this.modelId2Views.get(e);a||(a=new Set,this.modelId2Views.set(e,a)),a.add(t);let i=this.modelId2Models.get(e);if(i)for(let e of i)t.setModel(e)}unregisterView(e){if(!e.controller)return;if(e.controller!==this)throw Error("attempt to unregister view from wrong controller");let t=this.view2ModelIds.get(e);if(t)for(let s of t){let t=this.modelId2Views.get(s);t&&(t.delete(e),0===t.size&&this.modelId2Views.delete(s),e.setModel(void 0))}}clear(){for(let e of this.view2ModelIds)e[0].setModel(void 0);this.modelId2Models.clear(),this.modelId2Views.clear(),this.view2ModelIds.clear()}bind(e,t){this.registerModel(e,t)}action(e,t){return this.registerAction(e,t)}text(e,t){let s=new i(t);return this.bind(e,s),s}html(e,t){let s=new l(t);return this.bind(e,s),s}boolean(e,t){let s=new n(t);return this.bind(e,s),s}number(e,t,s){let a=new o(t,s);return this.bind(e,a),a}};function h(e,t){c.bind(e,t)}class u extends HTMLElement{constructor(e){super(),function(e,t,s){if(null!=t){for(let[a,i]of Object.entries(t))switch(a){case"children":break;case"action":e.setAction(i);break;case"model":e.setModel(i);break;case"class":e.classList.add(i);break;case"style":for(let[t,s]of Object.entries(i)){const a=/[A-Z]/g;t=t.replace(a,(e=>"-"+e.toLowerCase())),e.style.setProperty(t,s)}break;case"set":Object.defineProperty(t.set.object,t.set.attribute,{value:e});break;default:if("on"===a.substring(0,2))e.addEventListener(a.substr(2),i);else if("object"!=typeof i){if("http://www.w3.org/2000/svg"===s){const e=/[A-Z]/g;a=a.replace(e,(e=>"-"+e.toLowerCase()))}e.setAttributeNS(null,a,`${i}`)}}if(void 0!==t.children)for(let s of t.children)"string"==typeof s?e.appendChild(document.createTextNode(s)):e.appendChild(s)}}(this,e)}static define(e,t,s){const a=window.customElements.get(e);void 0===a?window.customElements.define(e,t,s):a!==t&&console.trace(`View::define(${e}, ...): attempt to redefine view with different constructor`)}setModel(e){console.trace("Please note that View.setModel(model) has no implementation.")}getModelId(){if(!this.hasAttribute("model"))throw Error("no 'model' attribute");let e=this.getAttribute("model");if(!e)throw Error("no model id");return"M:"+e}getActionId(){if(!this.hasAttribute("action"))throw Error("no 'action' attribute");let e=this.getAttribute("action");if(!e)throw Error("no action id");return"A:"+e}connectedCallback(){if(this.controller)return;let e="";try{e=this.getModelId()}catch(e){}""!=e&&c.registerView(e,this)}disconnectedCallback(){this.controller&&this.controller.unregisterView(this)}}class m extends u{constructor(e){super(e),void 0!==e?.model&&this.setModel(e.model)}updateModel(){}updateView(e){}setModel(e){if(e===this.model)return;const t=this;this.model&&this.model.modified.remove(t),e&&e.modified.add((e=>t.updateView(e)),t),this.model=e,this.isConnected&&this.updateView(void 0)}connectedCallback(){super.connectedCallback(),this.model&&this.updateView(void 0)}}class f extends m{constructor(e){super(e)}updateView(){void 0!==this.model?this.model instanceof i?this.innerText=this.model.value:this.model instanceof l?this.innerHTML=this.model.value:this.model instanceof o&&(this.innerText=`${this.model.value}`):this.innerText=""}}f.define("tx-display",f),f.define("tx-display",f);const g=[{name:"AbsoHybMaple",desc:"The sound of the Yamaha Absolute Hybrid Maple series. The perfect modern drum sound."},{name:"Steel Ring",desc:"A more rock sounding drum kit. The steel snare has lots of mid range ring to help it cut through music."},{name:"Spiralizer",desc:"This kit features an effect which continuously moves the pitch up without ever reaching the top."},{name:"Bop Groove",desc:"A more jazz sounding kit with open drum sounds and thinner cymbals. Perfect for more acoustic styles."},{name:"SwedishMetal",desc:"A punchy, mid-scooped drum sound with lots of attack. This is a perfect processed drum sound for metal music."},{name:"VintNashvlle",desc:"Typical of the drum sound found on country music in the 1960's and 1970's."},{name:"Off The Hook",desc:"A highly processed, very electronic drum kit that punches through the mix."},{name:"Black Vinyl",desc:"A typical 1990's metal drum sound with reverb – very dark!"},{name:"D-Funk",desc:"This kit features a very highly tuned snare for contemporary funk and similar styles."},{name:"OldStudioKit",desc:"This mimics a kit that has been recorded in an old studio through very old microphones and an overloaded mixing desk - it is slightly distorted."},{name:"Jet Reverb",desc:"This kit features a long reverb and a phaser effect to make the drum sound feel like it is swirling around you. Great on headphones."},{name:"Short Stack",desc:"A drum kit made of short, layered, acoustic and electronic drum sounds."},{name:"ModrnCountry",desc:"A contemporary acoustic pop drum kit with lots of attack."},{name:"ExcitedSnare",desc:"This kit has bright, high snare sound. The Presence effect on the [EFFECT] knob adds even more brightness and cut to the whole kit."},{name:"Olden Days",desc:"This kit recreates a open, tuned-down old drum kit in larger sizes."},{name:"Little Kit",desc:"This kit is designed to sound like a drum set in small sizes – 16” bass drum, 10, 12, 13” toms and 12” snare."},{name:'26" BassDrum',desc:"The classic 1970's big open rock drum sound with 26” bass drum and oversized toms."},{name:"Mix Vibe",desc:"This kit features a heavily dampened snare sound for ultra tight groove playing."},{name:"Hollywood",desc:"This kit recreates a classic 1960's American drum sound – the sounds of 1960's FM radio."},{name:"Engraved",desc:"This kit features a Yamaha brass 13x6.5” snare drum and the sound of closely recorded toms and kick. A very tight drum sound."},{name:"Filter Smack",desc:"The sound of this kit changes dramatically with your playing dynamics. It has a dynamic filter effect meaning the filter opens and lets more high frequencies through as you hit harder."},{name:"Classic Gate",desc:"This kit features a gated reverb effect that first became popular in 1980's. It's a big drum sound with no ring, and very dry."},{name:"Radio Dark",desc:"This kit simulates the lo-fi sound of an old radio."},{name:"Distorted",desc:"This kit features a distortion effect on the whole drum kit sound. You can adjust the distortion amount with [EFFECT] knob on the module."},{name:"EarlyReflctn",desc:"This kit has early-reflection reverb on it which is less harsh than gated reverb and still lets some of the natural ring of the drums come through."},{name:">Classic 8<",desc:"This kit features classic analog drum machine sounds."},{name:">The RX5<",desc:"This kit has sounds from the legendary Yamaha RX5 digital drum machine."},{name:"Selector",desc:"This kit has a more 'chopped up loop' sound and is ideal for drum'n'bass music."},{name:"45rpm",desc:"This kit is for dub-step and other more dance based styles."},{name:"Club Floor",desc:"This kit is more useful for hard dance music."},{name:"Mellow Volts",desc:"This kit features more mellow electronic drum sounds for a more chilled vibe."},{name:"Heavy Kick",desc:"This kit features a heavier kick sound for filling dance floors."},{name:"Crunch Delay",desc:"This kit features a more lo-fi sound and light delay effect on the snare."},{name:"Percussion",desc:"This kit has a Latin percussion set up on it including congas, timbales, shakers, cowbell and splash with a cajon bass drum sound."},{name:"Japan Kit",desc:"This kit features various traditional Japanese percussion sounds."},{name:"AHM+DynPhasr",desc:"AbsoHybMaple with effects"},{name:"AHM+Modulatr",desc:"AbsoHybMaple with effects"},{name:"AHM+AnalgDly",desc:"AbsoHybMaple with effects"},{name:"AHM+Symphnic",desc:"AbsoHybMaple with effects"},{name:"AHM+VCMFlngr",desc:"AbsoHybMaple with effects"}],b=new o(0);h("bank",b);const k=new o(0);h("program",k);const p=new i(g[0].name);h("kitName",p);const v=new i(g[0].desc);h("kitDesc",v);const w=new i("");h("msg0",w);const M=new i("");h("msg1",M);function y(e){console.log("MIDI ready!");let{input:t,output:s}=function(e){let t,s;for(let s of e.inputs){let e=s[1];if("DTX Drums"===e.name){t=e;break}}for(let t of e.outputs){let e=t[1];if("DTX Drums"===e.name){s=e;break}}return{input:t,output:s}}(e);void 0!==t&&void 0!==s?t.onmidimessage=T:console.log("Failed to find DTX Drums")}function T(e){const t=e;if(1===t.data.length&&(248===t.data[0]||254===t.data[0]))return;const s=new Uint8Array([240,126,127,6,2,67,0,65,93,6,0,0,0,127,247]);if(function(e,t){if(e.length!==t.length)return!1;var s=e.length;for(;s--;)if(e[s]!==t[s])return!1;return!0}(t.data,s))return void console.log("Found Yamaha DTX-PRO");if(153==t.data[0]){let e;switch(t.data[1]){case 16:e="Crash 2 Bell";break;case 17:e="Crash 2 Bow";break;case 36:e="Bass Drum (GM Electric Bass Drum)";break;case 37:e="Snare Side Stick (GM Side Stick)";break;case 38:e="Snare Center (GM Acoustic Snare)";break;case 40:e="Snare Rimshot (GM Electric Snare)";break;case 42:e="HiHat Controller (GM Closed Hi-Hat)";break;case 43:e="Tom 3 (GM Hi Floor Tom)";break;case 44:e="HiHat ??? (GM Pedal Hi-Hat)";break;case 46:e="HiHat Bow (GM Open Hi-Hat)";break;case 47:e="Tom 2 (GM Low-Mid Tom)";break;case 48:e="Tom 1 (GM Hi-Mid Tom)";break;case 49:e="Crash 1 Rim (GM Crash Cymbal 1)";break;case 51:e="Ride Bow (GM Ride Cymbal 1)";break;case 52:e="Ride Rim (GM Chinese Cymbal)";break;case 53:e="Ride Bell (GM Ride Bell)";break;case 55:e="Crash 1 Bell (GM Splash Cymbal)";break;case 57:e="Crash 2 Rim (GM Crash Cymbal 2)";break;case 59:e="Crash 1 Bow (GM Ride Cymbal 2)";break;case 78:e="HiHat Rim (GM Mute Cuica)";break;case 83:e="HitHat Foot Close";break;default:e="0x"+t.data[1].toString(16)}return void(t.data[2]>0&&(w.value=`${e} ${t.data[2]}`))}if(185===t.data[0]){let e;switch(t.data[1]){case 0:return;case 32:return void(b.value=t.data[2]);case 4:e="HiHat Controller Pressure";break;case 16:e="Snare Location";break;case 17:e="Ride Location";break;case 80:e="Ambience";break;case 81:e="Compression";break;case 82:e="Effect";break;default:e="0x"+t.data[1].toString(16)}return void(t.data[2]>0&&(M.value=`${e} ${t.data[2]}`))}if(201==t.data[0]){switch(k.value=t.data[1],b.value){case 0:if(k.value<g.length){const e=g[k.value];p.value=e.name,v.value=e.desc}break;case 1:p.value=`U${k.value+1}`,v.value="User Kit";break;case 2:p.value=`U${k.value+101}`,v.value="User Kit"}return}let a="MIDI message received at timestamp "+t.timeStamp+"["+t.data.length+" bytes]: ";for(let e=0;e<t.data.length;e++)a+="0x"+t.data[e].toString(16)+" ";console.log(a)}function A(e){console.log("Failed to get MIDI access - "+e)}return e.main=function(){try{navigator.requestMIDIAccess({sysex:!1}).then(y,A)}catch(e){p.value="",v.value="",w.value="Your browser does not support MIDI. Please try Firefox, Chrome or other."}},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
